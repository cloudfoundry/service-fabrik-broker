---
matrix:
  include:
    - language: go
      os:
        - linux
      go:
        - "1.17"
      git:
        depth: 3
      before_install:
        - curl https://raw.githubusercontent.com/golang/dep/master/install.sh | sh
        - go get golang.org/x/lint/golint
        - go get -v honnef.co/go/tools/cmd/staticcheck@v0.2.2
        - staticcheck -version
      install:
        - cd interoperator
        - env GO111MODULE=on go mod download
        - cd ../webhooks
        - dep ensure -v
        - cd ..
      script:
        - pushd interoperator
        - env GO111MODULE=on go fmt ./api/... ./controllers/... ./internal/... ./pkg/... ./
        - env GO111MODULE=on go vet ./api/... ./controllers/... ./internal/... ./pkg/... ./
        - env GO111MODULE=on golint ./api/... ./controllers/... ./internal/... ./pkg/... ./
        - PKGS=$(go list ./... | grep -v /vendor/)
        - staticcheck $PKGS
        - popd
        - pushd webhooks
        - go fmt ./pkg/webhooks/manager/... ./pkg/apis/...
        - go vet ./pkg/webhooks/manager/... ./pkg/apis/...
        - golint ./pkg/webhooks/manager/... ./pkg/apis/...
        - popd
        - pushd operator-apis
        - go fmt ./internal/...
        - go vet ./internal/...
        - golint ./internal/...
        - PKGS=$(go list ./... | grep -v /vendor/)
        - staticcheck $PKGS
        - popd
